
name := "Robert'; drop table students;--"

def s:String as $SQL
    return bitcast "\x1b[0;35m'$(s.replace("'","\x1b[34;1m''\x1b[0;35m"))'\x1b[m" as $SQL

def i:Int as $SQL return bitcast "\x1b[0;35m$i\x1b[m" as $SQL
def n:Num as $SQL return bitcast "\x1b[0;35m$n\x1b[m" as $SQL

age := 10
s := $SQL"SELECT * FROM students WHERE name = $name AND age > $age"
say "$s"

def s:String as $Quoted
    return bitcast "\x1b[0;35m\"$(s.replace('\','\\').replace('"','\"'))\"\x1b[m" as $Quoted

str := "one two"
str2 := 'with "quotes" in it'
say "$($Quoted[my strings are $str and $str2])"

def s:String as $HTML
    s = s.replace("&", "\x1b[34;1m&amp;\x1b[0;35m")
         .replace("<", "\x1b[34;1m&lt;\x1b[0;35m")
         .replace(">", "\x1b[34;1m&gt;\x1b[0;35m")
         .replace('"', "\x1b[34;1m&quot;\x1b[0;35m")
         .replace("'", "\x1b[34;1m&#39;\x1b[0;35m")

    return bitcast "\x1b[0;35m$s\x1b[m" as $HTML

def strings:[String] as $HTML
    return bitcast [
        c for c in "<ol>\n",
        for str in strings
            c for c in $HTML[<li>$str</li>]
        between
            "\n"[1]
        ,
        c for c in "\n</ol>",
    ] as $HTML

my_strings := ["item one", "I <3 escaping", "all done"]
html := $HTML[
    <body>
    $my_strings
    </body>
]
say "$html"
